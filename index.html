<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü—É—Ç—å –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ - –ú–∏—Ä –î—ã—Ö–∞–Ω–∏—è</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Marmelad&family=Philosopher:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div id="game-container">
        <!-- Game Canvas -->
        <canvas id="game-canvas"></canvas>

        <!-- Top HUD -->
        <div id="top-hud">
            <div class="hud-panel player-stats">
                <div class="avatar-mini" id="player-avatar-mini"></div>
                <div class="stats-info">
                    <div class="player-name" id="player-name-display">–ò—Å–∫–∞—Ç–µ–ª—å</div>
                    <div class="level-bar">
                        <span class="level-text">–£—Ä. <span id="player-level">1</span></span>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xp-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hud-panel currency-panel">
                <div class="currency-item">
                    <span class="currency-icon">‚ú®</span>
                    <span id="prana-coins">0</span>
                </div>
                <div class="currency-item">
                    <span class="currency-icon">üíé</span>
                    <span id="gems">0</span>
                </div>
            </div>
        </div>

        <!-- Meditation Timer Panel -->
        <div id="meditation-panel" class="side-panel">
            <div class="panel-header">
                <span>üßò –ü—Ä–∞–∫—Ç–∏–∫–∞</span>
                <button class="close-btn" onclick="toggleMeditationPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="timer-display">
                    <span id="timer-minutes">00</span>:<span id="timer-seconds">00</span>
                </div>
                <div class="timer-controls">
                    <button class="timer-preset" data-minutes="5">5 –º–∏–Ω</button>
                    <button class="timer-preset" data-minutes="10">10 –º–∏–Ω</button>
                    <button class="timer-preset" data-minutes="15">15 –º–∏–Ω</button>
                    <button class="timer-preset" data-minutes="30">30 –º–∏–Ω</button>
                    <button class="timer-preset" data-minutes="60">1 —á–∞—Å</button>
                </div>
                <div class="custom-timer">
                    <input type="number" id="custom-minutes" placeholder="–ú–∏–Ω—É—Ç—ã" min="1" max="180">
                    <button onclick="setCustomTimer()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>
                <div class="meditation-buttons">
                    <button id="start-meditation-btn" class="action-btn start-btn" onclick="startMeditation()">
                        ‚ñ∂ –ù–∞—á–∞—Ç—å
                    </button>
                    <button id="pause-meditation-btn" class="action-btn pause-btn" onclick="pauseMeditation()"
                        style="display:none;">
                        ‚è∏ –ü–∞—É–∑–∞
                    </button>
                    <button id="stop-meditation-btn" class="action-btn stop-btn" onclick="stopMeditation()"
                        style="display:none;">
                        ‚èπ –ó–∞–≤–µ—Ä—à–∏—Ç—å
                    </button>
                </div>

                <!-- Missed Breaths Counter -->
                <div class="missed-breaths-section">
                    <h4>–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≤–¥–æ—Ö–∏</h4>
                    <div class="missed-counter">
                        <button class="minus-btn" onclick="adjustMissedBreaths(-1)">‚àí</button>
                        <span id="missed-breaths-count">0</span>
                        <button class="plus-btn" onclick="adjustMissedBreaths(1)">+</button>
                    </div>
                    <p class="hint-text">–ö–∞–∂–¥—ã–π –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π –≤–¥–æ—Ö —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –Ω–∞ 2%</p>
                </div>

                <div class="retroactive-section">
                    <h4>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º</h4>
                    <div class="retro-input">
                        <input type="number" id="retro-minutes" placeholder="–ú–∏–Ω—É—Ç—ã" min="1">
                        <input type="number" id="retro-missed" placeholder="–ü—Ä–æ–ø—É—â–µ–Ω–æ" min="0" value="0">
                        <button onclick="addRetroactiveMeditation()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Panel -->
        <div id="stats-panel" class="side-panel">
            <div class="panel-header">
                <span>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                <button class="close-btn" onclick="toggleStatsPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="stat-row">
                    <span>–°–µ–≥–æ–¥–Ω—è:</span>
                    <span id="stat-today">0 –º–∏–Ω</span>
                </div>
                <div class="stat-row">
                    <span>–≠—Ç–∞ –Ω–µ–¥–µ–ª—è:</span>
                    <span id="stat-week">0 –º–∏–Ω</span>
                </div>
                <div class="stat-row">
                    <span>–≠—Ç–æ—Ç –º–µ—Å—è—Ü:</span>
                    <span id="stat-month">0 —á</span>
                </div>
                <div class="stat-row total">
                    <span>–í—Å–µ–≥–æ:</span>
                    <span id="stat-total">0 —á</span>
                </div>
                <div class="stat-row">
                    <span>–°–µ—Ä–∏—è –¥–Ω–µ–π:</span>
                    <span id="stat-streak">0 –¥–Ω–µ–π üî•</span>
                </div>
                <div class="stat-row">
                    <span>–¢–æ—á–Ω–æ—Å—Ç—å:</span>
                    <span id="stat-accuracy">100%</span>
                </div>
            </div>
        </div>

        <!-- Inventory/Gacha Panel -->
        <div id="gacha-panel" class="side-panel large-panel">
            <div class="panel-header">
                <span>üé∞ –•—Ä–∞–º –°—É–¥—å–±—ã</span>
                <button class="close-btn" onclick="toggleGachaPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="gacha-tabs">
                    <button class="gacha-tab active" data-tab="summon">–ü—Ä–∏–∑—ã–≤</button>
                    <button class="gacha-tab" data-tab="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
                    <button class="gacha-tab" data-tab="skins">–û–±—Ä–∞–∑—ã</button>
                </div>
                <div id="summon-tab" class="tab-content active">
                    <div class="gacha-banner">
                        <div class="banner-title">–ö–æ–ª–µ—Å–æ –°–∞–Ω—Å–∞—Ä—ã</div>
                        <div class="banner-image">üîÆ</div>
                    </div>
                    <div class="gacha-buttons">
                        <button class="gacha-btn single" onclick="doGachaPull(1)">
                            <span>–ü—Ä–∏–∑—ã–≤ √ó1</span>
                            <span class="cost">‚ú® 100</span>
                        </button>
                        <button class="gacha-btn multi" onclick="doGachaPull(10)">
                            <span>–ü—Ä–∏–∑—ã–≤ √ó10</span>
                            <span class="cost">‚ú® 900</span>
                        </button>
                    </div>
                    <div class="pity-info">
                        –î–æ –≥–∞—Ä–∞–Ω—Ç–∏–∏: <span id="pity-counter">0</span>/90
                    </div>
                </div>
                <div id="inventory-tab" class="tab-content">
                    <div class="inventory-grid" id="inventory-grid"></div>
                </div>
                <div id="skins-tab" class="tab-content">
                    <div class="skins-grid" id="skins-grid"></div>
                </div>
            </div>
        </div>

        <!-- Dialogue Panel -->
        <div id="dialogue-panel">
            <div class="dialogue-portrait" id="npc-portrait"></div>
            <div class="dialogue-content">
                <div class="dialogue-name" id="npc-name">–ú–∞—Å—Ç–µ—Ä</div>
                <div class="dialogue-text" id="dialogue-text"></div>
                <div class="dialogue-options" id="dialogue-options"></div>
            </div>
            <button class="dialogue-close" onclick="closeDialogue()">√ó</button>
        </div>

        <!-- Reward Popup -->
        <div id="reward-popup">
            <div class="reward-content">
                <div class="reward-title">–ù–∞–≥—Ä–∞–¥–∞!</div>
                <div class="reward-items" id="reward-items"></div>
                <button onclick="closeRewardPopup()">–ó–∞–±—Ä–∞—Ç—å</button>
            </div>
        </div>

        <!-- Achievement Popup -->
        <div id="achievement-popup">
            <div class="achievement-icon" id="achievement-icon">üèÜ</div>
            <div class="achievement-info">
                <div class="achievement-title" id="achievement-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!</div>
                <div class="achievement-desc" id="achievement-desc"></div>
            </div>
        </div>

        <!-- Bottom Menu -->
        <div id="bottom-menu">
            <button class="menu-btn" onclick="toggleMeditationPanel()">
                <span class="menu-icon">üßò</span>
                <span>–ü—Ä–∞–∫—Ç–∏–∫–∞</span>
            </button>
            <button class="menu-btn" onclick="toggleStatsPanel()">
                <span class="menu-icon">üìä</span>
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </button>
            <button class="menu-btn" onclick="toggleGachaPanel()">
                <span class="menu-icon">üé∞</span>
                <span>–•—Ä–∞–º</span>
            </button>
            <button class="menu-btn" onclick="toggleAchievementsPanel()">
                <span class="menu-icon">üèÜ</span>
                <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
            </button>
            <button class="menu-btn" onclick="toggleSettingsPanel()">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
        </div>

        <!-- E Button for Dialogue -->
        <button class="interact-btn" id="interact-btn" onclick="interactWithNearbyNPC()">
            E
        </button>

        <!-- Settings Panel -->
        <div id="settings-panel" class="side-panel">
            <div class="panel-header">
                <span>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                <button class="close-btn" onclick="toggleSettingsPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="setting-row">
                    <label>–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</label>
                    <input type="text" id="player-name-input" placeholder="–ò—Å–∫–∞—Ç–µ–ª—å">
                    <button onclick="updatePlayerName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
                <div class="setting-row">
                    <label>–í–æ–∑—Ä–∞—Å—Ç:</label>
                    <input type="number" id="player-age-input" min="1" max="150" value="25">
                    <button onclick="updatePlayerAge()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
                <div class="setting-row">
                    <label>–ó–≤—É–∫–∏:</label>
                    <input type="checkbox" id="sound-toggle" checked>
                </div>
                <div class="setting-row">
                    <label>–ú—É–∑—ã–∫–∞:</label>
                    <input type="checkbox" id="music-toggle" checked>
                </div>
                <hr>
                <div class="save-section">
                    <h4>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h4>
                    <button class="save-btn" onclick="exportSaveData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
                    <button class="save-btn" onclick="document.getElementById('import-file').click()">üì• –ò–º–ø–æ—Ä—Ç
                        JSON</button>
                    <input type="file" id="import-file" accept=".json" style="display:none"
                        onchange="importSaveData(event)">
                </div>
            </div>
        </div>

        <!-- Achievements Panel -->
        <div id="achievements-panel" class="side-panel large-panel">
            <div class="panel-header">
                <span>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
                <button class="close-btn" onclick="toggleAchievementsPanel()">√ó</button>
            </div>
            <div class="panel-content">
                <div class="achievements-grid" id="achievements-grid"></div>
            </div>
        </div>

        <!-- Particles Container -->
        <div id="particles-container"></div>
    </div>

    <!-- Scripts -->
    <script src="data/npcs-data.js"></script>
    <script src="data/dialogues-data.js"></script>
    <script src="data/achievements-data.js"></script>
    <script src="data/gacha-data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/sprites.js"></script>
    <script src="js/map.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/meditation.js"></script>
    <script src="js/rewards.js"></script>
    <script src="js/dialogues.js"></script>
    <script src="js/gacha.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
</body>

</html>